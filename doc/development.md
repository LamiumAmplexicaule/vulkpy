# Contributing and Developer's Guide

## Contributing
Any contributions are welcomed.

### Run on Actual GPUs
One of the most lacking part is running on various GPUs.
Any feedbacks are appriciated.


### When Find any problems / bugs
Check [issues](https://github.com/ymd-h/vulkpy/issues) first,
and open new one unless the same problem has been reported.



## Developer's Guide

### Code Layout

- `vulkpy/` (Main Package)
  - `vkarray.py`
    - Python core implementation
  - `_vkarray.cc`, `_vkarray.hh`
    - C++ internal implementation
  - `shader/`
    - GPU shaders
  - `nn/`
    - Neural Network implementation
  - `random.py`
    - Pseudo Random Number Generator (PRNG) implementation
  - `util.py`
    - Utility Function implementation
  - `vktyping.py`
    - Type implementation
- `doc/`
  - Document Site
- `example/`
  - Example Codes
- `test/`
  - Test Codes
- `.github/`
  - CI configuration
- `README.md`, `LICENSE`
  - Project-wide information.
- `setup.py`, `pyproject.toml`, `MANIFEST.in`
  - Configuration for Package Build
- `.coverage`
  - Configuration for Coverage
- `Dockerfile`, `.dockerignore`
  - Configuration for CI tasks (See below)
- `mypy.ini`
  - Configuration for Type Check
- `.gitignore`

### Continuous Integration (CI) & Continuous Delivery (CD)
We use GitHub Actions for CI/CD, and its configuration is defined at
`.github/workflows/vulkpy.yaml`

To make CI independent from the platform as much as possible,
we define actual CI tasks inside `Dockerfile`.

- Type Check with [Mypy](https://mypy.readthedocs.io/)
- Build wheel
- Run Unit Test & Regression Test
  - Report Coverage with [unittest-xml-reporting](https://github.com/xmlrunner/unittest-xml-reporting) & [coverage.py](https://coverage.readthedocs.io/)
- Build Document Site with [Sphinx](https://www.sphinx-doc.org/)


### Document Site
Document site is generated by [Sphinx](https://www.sphinx-doc.org/) during CI/CD.
We adopt [furo](https://github.com/pradyunsg/furo) theme.

Most documents are written in markdown (`.md`) and parsed by [MyST](https://myst-parser.readthedocs.io/).

All markdown files are located at `doc/` directory flatly. Even if we
restructure document site in future, flatten layout can prevent broken link.


API reference is automatically generated from docstring with
[sphinx-automodapi](https://sphinx-automodapi.readthedocs.io/).


### docstring
To make the usage understandable, all public classes and methods
should have docstring.

[Shpinx](https://www.sphinx-doc.org/) generates
[API reference](https://ymd-h.github.io/vulkpy/api.html)
from these docstring.


Basically we obey
[Numpy's style guide](https://numpydoc.readthedocs.io/en/latest/format.html),
however, we adopt following [PEP-257](https://peps.python.org/pep-0257/)
statement for class docstring;

> The docstring for a class should summarize its behavior and list the
> public methods and instance variables. If the class is intended to
> be subclassed, and has an additional interface for subclasses, this
> interface should be listed separately (in the docstring). The class
> constructor should be documented in the docstring for its __init__
> method. Individual methods should be documented by their own
> docstring.


To separate class docstring and `__init__()` docstring,
we configure Sphinx as follows;

```python
autodoc_class_signature = "separated"
autodoc_default_options = {
    "class-doc-from": "class"
}
```
